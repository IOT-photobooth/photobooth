<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./images/faviconV2.png" />
    <link rel="stylesheet" href="../css/main.css" />
    <title>Start</title>
  </head>
  <body>
    <div class="UI-page">
      <img class="logo" src="../images/ARTEVELDE_hs_logo RGB.png" alt="logo artevelde" />
      <p class="welcome">Welkom bij onze photobooth!</p>
      <button class="button-picture" id="take-picture">Neem foto</button>
    </div>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
      // const client = mqtt.connect(`ws://mqtt.eclipseprojects.io:80/mqtt`);
      const client = mqtt.connect(`wss://mqtt.eclipseprojects.io/mqtt`); // secure connection to the broker (port 443 is default for secure connections, it's not necessary to specify)

      const btnTakePic = document.querySelector("#take-picture");

      client.on("connect", () => {
        client.subscribe("photobooth/AHS", (err) => {
          if (!err) {
            client.publish("presence", "Hello from smartphone control");
            client.publish("photobooth/AHS", "start");
            console.log("we have connected");
            //client.publish
          }
        });
      });

      client.on("reconnect", () => {
        console.log("Reconnecting...");
      });

      client.on("offline", () => {
        console.log("Went offline...");
      });

      window.addEventListener("load", () => {
        client.publish("photobooth/AHS", "start");
      });

      client.on("message", (topic, message) => {
        const msg = message.toString();
        const time = new Date().toLocaleTimeString();
        console.log(`${time} - ${msg}`);
      });

      btnTakePic.addEventListener("click", (e) => {
        // disable button for 10 seconds
        btnTakePic.disabled = true;
        client.publish("photobooth/AHS", "flash");
        console.log("button clicked");
        setTimeout(() => {
          btnTakePic.disabled = false;
        }, 10000);
      });
    </script>
  </body>
</html>
